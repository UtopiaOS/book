<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>NeoFHS - Utopia OS</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="title_page.html">The Utopia Operating System</a></li><li class="chapter-item expanded affix "><a href="foreword.html">Foreword</a></li><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="chapter_01_getting_started.html"><strong aria-hidden="true">1.</strong> Getting started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_01_installing_utopia.html"><strong aria-hidden="true">1.1.</strong> Installing Utopia</a></li><li class="chapter-item expanded "><a href="chapter_01_setup_dev_env.html"><strong aria-hidden="true">1.2.</strong> Set up your dev environment</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_02_the_utopia_proposals.html"><strong aria-hidden="true">2.</strong> The Utopia proposals</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_02_1_neohfs.html" class="active"><strong aria-hidden="true">2.1.</strong> NeoFHS</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_03_the_utopia_components.html"><strong aria-hidden="true">3.</strong> The Utopia components</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_03_winter.html"><strong aria-hidden="true">3.1.</strong> Winter</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_04_the_utopia_apis.html"><strong aria-hidden="true">4.</strong> The Utopia APIs</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Utopia OS</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="neofhs"><a class="header" href="#neofhs">NeoFHS</a></h2>
<p>NeoFHS stands for Neo (Greek for new) File Hierarchy Standard, it builds up on the old <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">FreeDesktop File Hierarchy Standard</a>, and tries to make it more intuitive, providing human-readable names in the English language by default.</p>
<h3 id="introduction"><a class="header" href="#introduction">Introduction</a></h3>
<p>A File Hierarchy Standard (FHS) refers to the way files are stored on your computer. As a Linux user you might be familiar with <code>/home</code> being the home/user folder, <code>/dev</code> being for special or device files, and <code>/bin</code> being where executable files are stored. Someone from Windows would expect <code>C:\Program Files</code> (system) or <code>%localappdata%</code> (user) to contain programs and the user folders to be in <code>C:\Users</code>. The Utopia Developers believe that the FHS has to be clear and concise so that the end user doesn't have any trouble finding things and doesn't get confused by system files that don't matter to them.</p>
<p>The NeoFHS tries to simplify things and remove legacy directories or decisions that where made just to accommodate fragmentation like the /usr merge. It is heavily inspired and based on the <a href="https://gobolinux.org">GoboLinux</a> FHS, but with some improvements in the organization and separation of some types of software. For example in Utopia /Programs (CLI) and /Applications (GUI) are separate.</p>
<p>NeoFHS is built with these ideas in mind:</p>
<ul>
<li>A mother path (root path) should always be capitalized (<code>/Programs</code>, <code>/System</code>)</li>
<li>A path should always be human-readable (this means no <code>/usr</code> or <code>/etc</code>) and use common and simple English words</li>
<li>Paths should be explicit in their name about what they contain</li>
</ul>
<p>Now that we have discussed the reasoning and principals behind the NeoFHS, we can start examining how a common Utopia System is organized.</p>
<pre><code>.
├── Data/               -&gt; Resources that belong to the System, Individual programs or even the user
│   ├── Temporary       -&gt; Data that is ereased on next boot, or at any given moment, non critical information
│   └── Variable/       -&gt; Spool files, log files, etc.
│       ├── cache
│       ├── empty
│       ├── lib
│       ├── lock
│       ├── log
│       ├── run
│       └── spool
├── Core/               -&gt; Indispensable and immutable core of the operating system
│   ├── Boot            -&gt; EFI, bootloader, etc.
│   ├── Libraries       -&gt; Core System libraries, like the libc
│   └── Binaries        -&gt; Core System binaries, like cat, ls, sh, etc. 
├── System/             
│   ├── Settings        -&gt; System or Program config files that are propagated globally.
│   ├── Kernel/         
│   │   ├── Status      -&gt; Kernel status files (part of the /proc fileystem)
│   │   ├── Modules     -&gt; Kernel modules that load after the kernel boots
│   │   └── Objects     -&gt; A view of the kernel's device tree (/sys)
│   ├── Devices         -&gt; Device files managed by udev
│   ├── Library         -&gt; Fonts, Frameworks, Sounds, and other third party additions
│   └── Index/          -&gt; Links to the legacy tree 
│       ├── bin
│       ├── include
│       ├── lib
│       ├── libexec
│       └── share/
│           ├── consolefonts
│           ├── fonts
│           └── man/
│               ├── info
│               └── man{1-9}
├── Applications        -&gt; Sandboxed programs that have a GUI
├── Programs            -&gt; CLI/unsandboxed programs that run on the CLI
├── Users               -&gt; The users home folder
└── Volumes             -&gt; Mountpoints for filesystems or volumes (USBs, External drives)
</code></pre>
<p>As you can see above the new FHS attempts to be more intuitive, using plain English and benefiting from the fact our modern computers can handle very large paths.</p>
<p>Having a modernized FHS is beneficial for some decisions in utopia. For example, this makes having multiple versions of the same package possible. It also has benefits for some Utopia decisions, for example, thanks to this design it is possible to apply a Symlink Style Package Manager, which allows users to have multiple versions of the same package.</p>
<h3 id="surviving-alongside-the-legacy-tree"><a class="header" href="#surviving-alongside-the-legacy-tree">Surviving alongside the legacy tree</a></h3>
<p>One of the first things that might concern you when examining this new FHS is compatibility for literally all programs. The simple solution to this is to use <a href="https://en.wikipedia.org/wiki/Symbolic_link">Symbolic Links</a>. We use symlinks (Symbolic Links) to &quot;link&quot; the new directories to the legacy ones and hide the legacy directories from the user. These links are basically shortcuts that programs follow when they try to use the legacy FHS, so when a program tries to read <code>/etc</code> it instead reads <code>/System/Settings</code>. By using these symlinks we can keep compatibility with the legacy file hierarchy while still presenting a modern hierarchy to the user. <strong>Programs that have not updated to support NeoFHS will continue to work on Utopia without the user noticing.</strong> This is a great compromise since we cannot expect all programs to add dedicated support to Utopia.</p>
<p>Below are legacy FHS directories followed by what they are symlinked to. Click <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">here</a>. For an explanation of what these directories are for.</p>
<pre><code>/etc            -&gt; /System/Settings
/boot           -&gt; /Core/Boot
/var            -&gt; /Data/Variable
/tmp            -&gt; /Data/Temporary
/home           -&gt; /Users
/proc           -&gt; /System/Kernel/Status
/dev            -&gt; /System/Devices
/sys            -&gt; /System/Kernel/Objects
/bin            -&gt; /System/Index/bin
/lib            -&gt; /System/Index/lib
/lib64          -&gt; /System/Index/lib
/sbin           -&gt; /System/Index/bin
/usr/bin        -&gt; /System/Index/bin
/usr/sbin       -&gt; /System/Index/bin
/usr/share      -&gt; /System/Index/share
/usr/libexec    -&gt; /System/Index/libexec
/usr/include    -&gt; /System/Index/include
</code></pre>
<p>As a developer making programs for Utopia we prefer you support NeoFHS but if you don't include dedicated support these symbolic links will make sure your program works fine. Everything should work as you expect, so if your program reads a file in <code>/etc/settings.toml</code> filesystem magic will redirect your calls to <code>/System/Settings/settings.toml</code>.</p>
<p>As a User, you do not want to see all these legacy directories, so we need to hide them. Linux itself does not have a hidden file system built in like Windows and macOS (putting <code>.</code> in front of these directories is not ideal), but GoboLinux provides a solution for this that we can use that works seamlessly and cleanly.</p>
<p>While you can read about the solution GoboLinux used <a href="https://gobolinux.org/doc/articles/gobohide.html">here</a>, in a nutshell, it keeps a list of the <code>inodes</code> in a kernel linked list. After this, when performing the <code>readdir()</code> syscall, the kernel verifies if said inode is on the <code>inode</code> list. If this is true, it won't be copied to the destination buffer.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="chapter_02_the_utopia_proposals.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="chapter_03_the_utopia_components.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="chapter_02_the_utopia_proposals.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="chapter_03_the_utopia_components.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
