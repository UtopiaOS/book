<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>NeoFHS - Utopia OS</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="title_page.html">The Utopia Operating System</a></li><li class="chapter-item expanded affix "><a href="foreword.html">Foreword</a></li><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="chapter_01_getting_started.html"><strong aria-hidden="true">1.</strong> Getting started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_01_installing_utopia.html"><strong aria-hidden="true">1.1.</strong> Installing Utopia</a></li><li class="chapter-item expanded "><a href="chapter_01_setup_dev_env.html"><strong aria-hidden="true">1.2.</strong> Setup your dev enviroment</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_02_the_utopia_proposals.html"><strong aria-hidden="true">2.</strong> The Utopia proposals</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_02_1_neohfs.html" class="active"><strong aria-hidden="true">2.1.</strong> NeoFHS</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_03_the_utopia_components.html"><strong aria-hidden="true">3.</strong> The Utopia components</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapter_03_winter.html"><strong aria-hidden="true">3.1.</strong> Winter</a></li></ol></li><li class="chapter-item expanded "><a href="chapter_04_the_utopia_apis.html"><strong aria-hidden="true">4.</strong> The Utopia APIs</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Utopia OS</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="neofhs"><a class="header" href="#neofhs">NeoFHS</a></h2>
<p>NeoFHS stands for Neo (Greek for new) File Hierarchy Standard, it builds up on the old <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">FreeDesktop File Hiearchy Standard</a>, and tries to make it more intuitive, providing human readable names in the english language by default.</p>
<h3 id="introduction"><a class="header" href="#introduction">Introduction</a></h3>
<p>A file hiearchy standard, refers to the way diverse system components are stored across the computer, for example, if you come from a typical Linux background, you might be familiar with executables being on <code>/bin</code>or <code>/usr/bin</code> your user being on <code>/home</code>, or if you come from Windows, you might be used to programs being on <code>C:\Program Files</code>, in the same way, Utopia defines it's own FHS, where it expects diverse files to be located, and where the end user, might expect to find things.</p>
<p>The NeoFHS tries to simplify things and remove legacy directories or desicisions that where made just to acomodate the fragmentation (such as the /usr merge), it is heavily inspired by <a href="https://gobolinux.org">GoboLinux</a> but with some improvements over the top, mainly, in the organization and separation of some types of software (For example, in Utopia /Programs and /Applications are different things).</p>
<p>NeoFHS is built with this ideas in mind:</p>
<ul>
<li>A mother path (root path) should always be capitalized (<code>/Programs</code>, <code>/System</code>)</li>
<li>A path should always be human readable (this means no <code>/usr</code> or <code>/etc</code>) and use common and simple english words</li>
<li>Paths should be explicit in their name about what they contain</li>
</ul>
<p>Now that we have discussed the reasons and principals behind the NeoFHS, we can start examining how a common Utopia System is organized.</p>
<pre><code>.
├── Data/               -&gt; Resources that belong to the System, Individual programs or even the user
│   ├── Temporary       -&gt; Data that is ereased on next boot, or at any given moment, non critical information
│   └── Variable/       -&gt; Spool files, log files, etc.
│       ├── cache
│       ├── empty
│       ├── lib
│       ├── lock
│       ├── log
│       ├── run
│       └── spool
├── Core/               -&gt; Indispensable, unmutable core parts of the operating system
│   ├── Boot            -&gt; All the EFI files, bootloader, etc.
│   ├── Libraries       -&gt; Core System libraries, like the libc
│   └── Binaries        -&gt; Core System binaries, like cat, ls, sh, etc. 
├── System/             
│   ├── Settings        -&gt; System or Program config files that are propagated globally.
│   ├── Kernel/         
│   │   ├── Status      -&gt; Kernel status files (part of the /proc fileystem)
│   │   ├── Modules     -&gt; Kernel modules that load after the kernel boots
│   │   └── Objects     -&gt; A view of the kernel's device tree (/sys)
│   ├── Devices         -&gt; Device files managed by udev
│   ├── Library         -&gt; Fonts, Frameworks, Sounds, and other third party additions
│   └── Index/          -&gt; Links to the legacy tree 
│       ├── bin
│       ├── include
│       ├── lib
│       ├── libexec
│       └── share/
│           ├── consolefonts
│           ├── fonts
│           └── man/
│               ├── info
│               └── man{1-9}
├── Applications        -&gt; Sandboxed programs that have a GUI
├── Programs            -&gt; CLI/unsandboxed programs that run on the CLI
├── Users               -&gt; The users root folder
└── Volumes             -&gt; Mountpoints for filesystems or volumes (USBs, External drives)
</code></pre>
<p>As you can see above, the new FHS attempts to be more intuitive, using plain english and benefiting from the fact our modern computers can handle very large paths.</p>
<p>It also benefits some Utopia desicions, for example, thanks to this design, it is possible to apply a Symlink Style Package Manager, which allows users to have multiple versions of the same package.</p>
<h3 id="surviving-alongside-the-legacy-tree"><a class="header" href="#surviving-alongside-the-legacy-tree">Surviving alongside the legacy tree</a></h3>
<p>The first problem that might emerge when looking at the new FHS, is, <strong>How the hell does this not break the whole OS?</strong>, and to answer your question, it does break the whole OS, or it would, if it wasn't for the amazing power of <a href="https://en.wikipedia.org/wiki/Symbolic_link">Symbolic Links</a>, thanks to Symlinks (Symbolic Links) we can keep the old file hiearchy there, while also having the benefits of the new one as Applications adapt overtime.</p>
<p>To make the story short, in case you don't know what a symlink is, think about it like a shortcut, yes, the same one your gradma has lots of on her desktop, these shortcuts aren't <em>really</em> the program, but rather, a quickway to access the location of said program, this design, allows you to make <code>/etc</code> on the old FHS a &quot;shortcut&quot; to <code>/System/Settings</code> on our new FHS.</p>
<p>Below, you can see what parts of the old FHS are symlinked to our new FHS, in case you didn't click on the first link where we mentioned the current FHS, it is recommend you do that now by clicking <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">here</a>.</p>
<pre><code>/etc            -&gt; /System/Settings
/boot           -&gt; /Core/Boot
/var            -&gt; /Data/Variable
/tmp            -&gt; /Data/Temporary
/home           -&gt; /Users
/proc           -&gt; /System/Kernel/Status
/dev            -&gt; /System/Devices
/sys            -&gt; /System/Kernel/Objects
/bin            -&gt; /System/Index/bin
/lib            -&gt; /System/Index/lib
/lib64          -&gt; /System/Index/lib
/sbin           -&gt; /System/Index/bin
/usr/bin        -&gt; /System/Index/bin
/usr/sbin       -&gt; /System/Index/bin
/usr/share      -&gt; /System/Index/share
/usr/libexec    -&gt; /System/Index/libexec
/usr/include    -&gt; /System/Index/include
</code></pre>
<p>As you can see above, this implementation allows us to ensure programs don't really need to update directory to support our new FHS (but we would like to), rather, a program can read a file located at <code>/etc/my_settings.toml</code> and a little bit of filesystem magic will redirect this call to the real file at <code>/System/Settings/my_settings.toml</code>, however, even after this, we still have one big problem: <strong>Repeated folders</strong>, what do we mean with this, is nobody wants to see <code>/etc</code> if <code>/System/Settings</code>is already thing, however, there is a solution to this, used in diverse operating systems, such as Windows and macOS: <strong>hidden files</strong>, our solution is borrowed from our friends at GoboLinux and it ensures a clean and elegant way of hidding directories.</p>
<p>While you can read about the solution GoboLinux used <a href="https://gobolinux.org/doc/articles/gobohide.html">here</a> in a nutshell, it keeps a list of the <code>inodes</code> in a kernel linked list, after this, when performing the <code>readdir()</code> syscall, the kernel verifies if said inode is on the <code>inode</code> list, if this is true, it wont be copied to the destination buffer.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="chapter_02_the_utopia_proposals.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="chapter_03_the_utopia_components.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="chapter_02_the_utopia_proposals.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="chapter_03_the_utopia_components.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
